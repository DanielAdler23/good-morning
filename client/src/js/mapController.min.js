function initMap(){get_all_tweets(),setTimeout(()=>{document.querySelector("div#loading").remove(),map=new google.maps.Map(document.getElementById("map"),{zoom:2,center:new google.maps.LatLng(0,0),minZoom:2,disableDefaultUI:!0,styles:[{elementType:"geometry",stylers:[{color:"#0ba9ff"}]},{elementType:"labels.text.stroke",stylers:[{color:"#42ace3"}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"administrative.country",elementType:"geometry",stylers:[{color:"#45d1f1"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#45d1f1"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#45d1f1"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#45d1f1"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#45d1f1"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#45d1f1"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#45d1f1"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]});var a=document.createElement("script");a.src=url;var b=document.getElementsByTagName("body")[0];b.appendChild(a),set_markers(allMarkers)},8e3)}function as(a){var c,b=[];for(var d of a)for(var e of d)c={x:e[0],y:e[1]},b.push(c);return b}function drawMap(a){var b=a.rows;for(var c in b){var d=[];if(d.push(b[c][0]),"Antarctica"!=b[c][0]){var f,e=[],g=[],h=b[c][1].geometries;if(h)for(var i in h)g.push(as(h[i].coordinates)),e.push(constructNewCoordinates(h[i]));else e=constructNewCoordinates(b[c][1].geometry),f=b[c][1].geometry.coordinates,g.push(as(f));var j;if(1==g.length)for(var l of g)region=new Region(l),j=region.centroid();else{var m=[];for(var n of g)region=new Region(n),m.push(region.centroid());m.length>2?(region=new Region(m),j=region.centroid()):j={x:(m[0].x+m[1].x)/2,y:(m[0].y+m[1].y)/2}}var o=new google.maps.Polygon({paths:e,strokeColor:"#42ace3",strokeOpacity:1,strokeWeight:1,fillOpacity:0,ID:d[0],center:j});google.maps.event.addListener(o,"dblclick",function(){if(console.log(this),countryMark.length>0)for(var a of countryMark)a.setOptions({fillOpacity:0});this.setOptions({fillOpacity:.7,fillColor:"#D0FF6C"}),map.setOptions({disableDoubleClickZoom:!0}),map.setCenter(new google.maps.LatLng(this.center.y,this.center.x));var c,b=[];b.push(get_tweets_by_country(this.ID.toLowerCase())),console.log(b);for(var d=document.getElementById("tenPopular");d.hasChildNodes();)d.removeChild(d.lastChild);for(var e of b)for(k of e)c=document.createElement("input"),c.type="button",c.value=k,d.appendChild(c);document.getElementById("countryName").innerHTML=this.ID,document.getElementById("WordsMostPopular").innerHTML="10 Most Popular Words in 'Good Morning' Tweets",countryMark.push(this)}),o.setMap(map)}}}function Point(a,b){this.x=a,this.y=b}function Region(a){this.points=a||[],this.length=a.length}function constructNewCoordinates(a){var b=[],c=a.coordinates[0];for(var d in c)b.push(new google.maps.LatLng(c[d][1],c[d][0]));return b}function set_markers(a){for(var b of a){var c=b.coordinates,d=new google.maps.LatLng(c.latitude,c.longitude),e=new google.maps.Marker({position:d,icon:0==b.color?blueDot:greenDot,map:map,id:b._id});markerBubble(e,b),arrMarkers.push(e)}}function removeMarkers(){for(var a of arrMarkers)a.setMap(null);arrMarkers=[]}function markerBubble(a){a.addListener("click",function(){prevBubble&&prevBubble.close();var b=get_tweet_content(a.id),c='<div id="content"><img id="tweetUserPicture" src="'+b.picture+'"><h1 id="firstHeading" class="firstHeading">@'+b.user+'</h1><div id="bodyContent"><p>'+b.text+"</p></div></div>",d=new google.maps.InfoWindow({content:c,maxWidth:250});prevBubble=d,d.open(map,a)})}function cleanTime(a){if(a.includes("PM")){var b=parseInt(a.replace(/\D/g,""));return b+12}return a.replace(/\D/g,"").trim()}function get_all_tweets(){$.ajax({type:"GET",async:!1,dataType:"json",url:"https://gutenmorgen.herokuapp.com/tweets",success:function(a){removeMarkers();for(var b of a)b.color=0;allMarkers=a}})}function get_tweets_by_country(a){var b;return $.ajax({type:"GET",async:!1,dataType:"json",url:`https://gutenmorgen.herokuapp.com/tweets/country/${a}`,success:function(a){b=a}}),b}function get_tweet_content(a){var b;return $.ajax({type:"GET",async:!1,dataType:"json",url:`https://gutenmorgen.herokuapp.com/tweets/${a}/content`,success:function(a){b=a[0]}}),b}function get_tweets_by_time(a,b){var c=allMarkers.map(c=>{return c.time<b&&c.time>a-1?c.color=1:c.color=0,c});return c}var map,allMarkers,url="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20name%2C%20kml_4326%20FROM%201foc3xO9DyfSIF6ofvN0kp2bxSfSeKog5FbdWdQ&callback=drawMap&key=AIzaSyAm9yWCV7JPCTHCJut8whOjARd7pwROFDQ",iconBase="https://maps.google.com/mapfiles/kml/shapes/",blueDot="./img/blueDot.png",greenDot="./img/greenDot.png",arrMarkers=[],firstTime=!1,prevBubble=!1,countryMark=[];Region.prototype.area=function(){var b,c,d,e,a=0;for(b=0,c=this.length-1;b<this.length;c=b,b++)d=this.points[b],e=this.points[c],a+=d.x*e.y,a-=d.y*e.x;return a/=2},Region.prototype.centroid=function(){var c,d,e,f,g,a=0,b=0;for(c=0,d=this.length-1;c<this.length;d=c,c++)f=this.points[c],g=this.points[d],e=f.x*g.y-g.x*f.y,a+=(f.x+g.x)*e,b+=(f.y+g.y)*e;return e=6*this.area(),new Point(a/e,b/e)};var hours=["01 AM","02 AM","03 AM","04 AM","05 AM","06 AM","07 AM","08 AM","09 AM","10 AM","11 AM","12 AM","01 PM","02 PM","03 PM","04 PM","05 PM","06 PM","07 PM","08 PM","09 PM","10 PM","11 PM","12 PM"];$(function(){$("#range").ionRangeSlider({type:"double",grid:!0,values:hours,prettify:function(a){return moment(a,"X").format("hh A")},onStart:function(a){},onChange:function(a){},onFinish:function(a){if(firstTime){var b=cleanTime(a.from_value),c=cleanTime(a.to_value);removeMarkers(),set_markers(get_tweets_by_time(b,c))}else firstTime=!0},onUpdate:function(a){}})});